# 體重記錄追蹤系統

<p align="center">
  <img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Laravel Logo">
</p>

## 專案概述

體重記錄追蹤系統是一個簡潔實用的個人健康管理工具，使用者可以每日記錄體重數據，系統會自動生成統計圖表，幫助使用者直觀地了解體重變化趨勢。

### 技術亮點：Laravel 8 到 Laravel 12 的成功升級

本專案最大的技術亮點是成功從 **Laravel 8** 升級到 **Laravel 12**，展示了對 Laravel 框架深入理解和技術維護能力。升級過程涉及多方面的調整和優化：

- 更新核心依賴和配置
- 適應新版本的語法和架構變化
- 遷移前端資源管理從 Laravel Mix 到 Vite
- 優化程式碼以符合 PHP 8.4 標準
- 修改中介層和路由定義以適應新版本
- **模型最佳實踐**：Weight 模型採用 Laravel 12 最佳實踐
  - 使用強型別提示（BelongsTo）
  - 精確的屬性轉換（decimal:1 用於體重精度）
  - 簡化的關聯方法定義
  - 清潔的程式碼結構，移除冗餘註解

## 功能特色

### 核心功能
- **用戶認證系統**：安全的註冊和登入功能
- **體重記錄**：簡單直觀的體重數據輸入界面
- **數據管理**：方便地查看、編輯和刪除歷史記錄
- **視覺化圖表**：基於 Chart.js 的體重變化趨勢圖
- **體重目標管理**：設定和追蹤個人體重目標
- **數據分析**：體重趨勢分析和健康指標計算
- **數據導出**：支援 CSV 和 PDF 格式的數據導出
- **響應式設計**：適配各種設備尺寸的界面

### 🎮 遊戲化功能（已實作）

本專案已完整實作減重遊戲化系統，透過遊戲化機制提升用戶持續減重的動力：

#### 核心功能
- **每日任務系統**：工作日和假日不同的任務設定，完成任務獲得積分
- **成就系統**：
  - 動態體重里程碑成就（根據起始體重和目標體重自動生成 7 個里程碑）
  - 特殊成就：完美一週、完美一月、週末戰士、省錢達人、散步狂人、早睡冠軍、斷食大師
- **積分系統**：完成任務和達成成就獲得積分，可用於兌換獎勵
- **獎勵商店**：使用積分兌換放縱餐券、小確幸等獎勵
- **連續達成追蹤**：記錄連續完成任務的天數，激勵持續努力
- **激勵語錄**：根據進度顯示個性化激勵訊息

#### 新增統計與報表功能
- **遊戲化統計圖表**：
  - 積分趨勢圖（折線圖）：顯示每日積分和週任務積分趨勢
  - 任務完成率圓餅圖：視覺化任務完成情況
  - 連續達成天數趨勢圖（柱狀圖）：追蹤連續達成記錄
- **週報表**：每週表現總結，包含體重變化、任務完成統計、積分統計、解鎖成就、連續達成和目標建議
- **月報表**：每月表現總結，包含完整統計、本月亮點和下月建議

#### 效能優化
- **快取機制**：
  - 成就定義資料快取（1小時）
  - 使用者里程碑計算結果快取（30分鐘）
  - 已解鎖成就快取（10分鐘）
  - 任務完成統計快取（5分鐘）
- **自動快取清除**：在關鍵操作後自動清除相關快取，確保資料一致性

#### UI/UX 改善
- **動畫效果**：
  - 成就解鎖動畫（滑入、震動、自動消失）
  - 任務完成互動效果（勾選動畫、背景色漸變、完成慶祝效果）
  - 積分變化動畫（數字滾動動畫、浮動提示）
  - 進度條平滑填充動畫
- **響應式設計**：所有新增功能都支援手機和桌面端，圖表在小螢幕上自動調整

## 技術棧

### 後端
- **PHP 8.4**：最新穩定版本
- **Laravel 12**：最新版本的 Laravel 框架
- **MySQL**：數據存儲

### 前端
- **Blade 模板引擎**
- **Livewire 3**：全端 PHP 框架，用於即時互動組件
- **Tailwind CSS**：現代化的 UI 設計
- **Alpine.js**：輕量級 JavaScript 框架，用於簡單 UI 互動和動畫
- **Chart.js**：數據視覺化（統計圖表）
- **Vite**：前端資源打包工具

## 安裝與設置

### 系統要求
- PHP >= 8.2
- Composer
- Node.js 和 npm
- MySQL 或其他 Laravel 支持的數據庫

### 安裝步驟

1. 克隆存儲庫
```bash
git clone https://github.com/yourusername/weight-tracker.git
cd weight-tracker
```

2. 安裝 PHP 依賴
```bash
composer install
```

3. 安裝前端依賴
```bash
npm install
```

4. 配置環境
```bash
cp .env.example .env
php artisan key:generate
```

5. 設置數據庫
   - 在 `.env` 文件中配置數據庫連接
   - 運行遷移
```bash
php artisan migrate
```

6. 編譯前端資源
```bash
npm run build
```

7. 啟動開發服務器
```bash
php artisan serve
```

## 使用指南

### 基本功能
1. 註冊/登入系統
2. 在主頁面輸入當天的體重數據
3. 查看「所有記錄」頁面管理歷史數據
4. 在「統計圖」頁面查看體重變化趨勢
5. 設定體重目標並追蹤進度

### 遊戲化功能
1. **每日任務**：前往「任務」頁面，勾選完成當日的健康任務（飲食、運動、睡眠等）
2. **成就系統**：在「成就」頁面查看已解鎖和未解鎖的成就，達成條件自動解鎖
3. **積分管理**：完成任務和達成成就獲得積分，在儀表板查看可用積分
4. **獎勵商店**：使用積分兌換獎勵，查看兌換歷史
5. **統計分析**：在「統計」頁面查看積分趨勢、任務完成率、連續達成記錄
6. **報表功能**：查看週報表和月報表，了解整體表現和目標建議

### 資料庫設定
遊戲化功能需要執行以下遷移和 Seeder：
```bash
php artisan migrate
php artisan db:seed --class=AchievementSeeder
```

## 專案亮點：Laravel 版本升級

### 升級概述

本專案展示了從 Laravel 8 到 Laravel 12 的完整升級過程，涉及以下主要方面：

1. **核心依賴更新**
   - 更新 PHP 版本要求為 ^8.2
   - 更新 Laravel 框架版本為 ^12.0
   - 更新相關套件和依賴

2. **架構調整**
   - 更新中介層結構和命名
   - 調整路由服務提供者
   - 更新異常處理機制

3. **前端工具鏈遷移**
   - 從 Laravel Mix 遷移到 Vite
   - 更新 JavaScript 模組系統
   - 優化 Tailwind CSS 配置

4. **程式碼現代化**
   - 添加型別提示
   - 使用 PHP 8 的新特性
   - 優化模型定義

### 升級挑戰與解決方案

升級過程中遇到的主要挑戰包括：

1. **中介層變更**：Laravel 12 中的中介層結構有所調整，需要更新 `Kernel.php` 文件。
2. **路由定義**：適應新版本的路由定義方式。
3. **認證系統**：更新與 Laravel 12 兼容的認證機制。
4. **前端資源管理**：從 Mix 遷移到 Vite 需要重新配置資源編譯流程。

這些挑戰通過仔細閱讀官方文檔、逐步測試和迭代優化得到了解決，確保系統在新版本框架下穩定運行。

## 最新更新：Livewire 3 完整遷移完成 (2026年1月)

### ✅ Livewire 3 完整遷移

已完成從傳統 Blade + Alpine.js + 自訂 JavaScript 架構到 **Livewire 3 + Alpine.js** 的完整遷移：

#### 遷移成果
- **10 個 Livewire 組件**：所有核心功能都已遷移到 Livewire 組件
  - `WeightRecordForm`：體重記錄表單（表單驗證、AJAX 提交、獎勵處理）
  - `WeightRecordList`：體重記錄列表（分頁、篩選、編輯、刪除）
  - `DailyTaskList`：每日任務列表（任務切換、積分計算、進度追蹤）
  - `PointsDisplay`：積分顯示（即時更新、動畫效果）
  - `AchievementList`：成就列表（進度追蹤、解鎖動畫）
  - `AchievementShow`：成就詳情
  - `RewardShop`：獎勵商店（積分兌換、兌換歷史）
  - `GamificationStats`：統計圖表（Chart.js 整合、時間範圍選擇）
  - `WeeklyReport`：週報表（統計計算、目標建議）
  - `MonthlyReport`：月報表（完整統計、亮點生成）

#### 架構優化
- **統一前端互動邏輯**：所有業務邏輯都在 Livewire 組件中處理
- **減少自訂 JavaScript 80% 以上**：移除 `weight-manager.js` 和 `chart-enhancer.js`
- **簡化 Alpine.js 使用**：只用於簡單的 UI 互動（顯示/隱藏、動畫、`:class` 綁定）
- **移除所有 fetch API 調用**：改用 Livewire 方法和事件系統
- **性能優化**：使用 `wire:loading`、`wire:defer` 等 Livewire 特性

#### 測試覆蓋
- **180 個測試全部通過**（418 個斷言）
- **完整的 Livewire 組件測試**：每個組件都有完整的測試覆蓋
- **測試場景包括**：
  - 表單驗證和提交
  - 權限控制
  - 事件處理
  - 邊界情況
  - 錯誤處理

#### 技術優勢
- **PHP 全端開發**：後端邏輯和前端互動都在 PHP 中處理
- **即時互動**：Livewire 提供即時的伺服器端狀態同步
- **SEO 友善**：伺服器端渲染，對 SEO 更友善
- **開發效率提升**：Laravel 開發者可以快速上手，不需要學習複雜的前端框架
- **代碼可維護性提升**：統一的架構模式，更容易維護和擴展

## 歷史更新：任務系統優化與社群登入功能 (2026年1月)

### ✅ 每日任務系統優化

修復並優化了每日任務系統的使用者體驗：

#### 核心改進
- **任務列表顯示修復**：改用 Blade 模板渲染任務列表，確保任務項目正確顯示
- **進度計算優化**：修正進度條計算邏輯，正確顯示完成進度（例如：0/4、1/4、2/4 等）
- **「完美一天」顯示邏輯**：只有在所有任務都完成時才顯示「完美一天」慶祝訊息
- **互動體驗提升**：
  - 任務項目有明顯的點擊提示和視覺反饋
  - 未完成任務顯示 + 圖示，hover 時變色
  - 已完成任務顯示 ✓ 標記，綠色背景
  - 加入 tooltip 提示說明如何完成任務

#### 體重記錄限制與防刷分機制
- **每日記錄限制**：每天只能記錄一次體重，防止重複記錄
- **獎勵邏輯優化**：只有當天記錄的體重才能獲得 +20 積分獎勵，補記的記錄只能取消漏記扣分
- **防刷分機制**：刪除當天建立的記錄時會扣除已獲得的積分，防止反覆刪除和新增刷分

#### 目標管理優化
- **目標進度計算**：修正目標進度天數計算，四捨五入到整數顯示
- **活躍目標限制**：如果已有活躍目標，只能編輯現有目標，不能新增多個目標

### ✅ 社群登入功能

新增 Google OAuth 社群登入功能：

#### 功能特色
- **Google 登入/註冊**：使用 Google 帳號快速登入或註冊
- **帳號自動連結**：如果使用社群登入的電子郵件已存在，自動連結到現有帳號
- **安全驗證**：社群登入的用戶電子郵件自動驗證
- **無密碼登入**：社群用戶不需要設定密碼

#### 技術實作
- 使用 Laravel Socialite 套件
- 支援 OAuth 2.0 認證流程
- 資料庫欄位擴展：`provider`、`provider_id` 欄位
- 完整的錯誤處理和用戶提示

#### 測試覆蓋
- 新增 `SocialAuthTest.php` 測試檔案
- 測試場景包括：新用戶註冊、現有用戶連結、登入流程、錯誤處理等

## 歷史更新：記錄體重獎勵系統與成就機制 (2026年1月)

### ✅ 記錄體重獎勵與懲罰機制

新增完整的記錄體重激勵系統，鼓勵用戶養成每日記錄習慣：

#### 核心功能
- **記錄體重獎勵**：每次記錄體重獲得 +20 積分（固定獎勵）
- **漏記扣分機制**：每漏記一天扣除 10 積分（最低扣到 0，不會變負數）
- **獎勵/懲罰比例**：2:1（記錄獎勵 20 > 漏記扣分 10），鼓勵持續記錄
- **即時通知**：記錄獎勵和扣分都有視覺化通知顯示

#### 記錄體重成就系統
- **記錄習慣養成**：連續記錄體重 7 天，獎勵 50 積分
- **忠實記錄者**：連續記錄體重 30 天，獎勵 300 積分
- **自動檢查**：每次記錄體重時自動檢查是否達成成就條件
- **連續記錄計算**：智能計算連續記錄天數，中斷後重新計算

#### 個人資料設定增強
- **起始體重設定**：在個人資料中新增起始體重欄位（30-200 公斤）
- **里程碑計算**：設定起始體重後，系統自動計算個人化體重里程碑
- **快取管理**：更新起始體重後自動清除相關里程碑快取

#### 測試覆蓋
- **新增測試檔案**：21 個新測試，65 個斷言全部通過
  - `ProfileTest.php`：個人資料設定功能測試（6 個測試）
  - `PointsServiceTest.php`：積分服務單元測試（6 個測試）
  - `WeightRecordingRewardTest.php`：記錄體重獎勵系統測試（9 個測試）
- **測試場景**：
  - 起始體重驗證規則測試
  - 記錄獎勵和扣分邏輯測試
  - 成就解鎖條件測試
  - 安全扣分邊界情況測試

#### 程式碼品質改善
- **CSS 衝突修復**：修復所有表單欄位的 CSS conflict 警告
  - `profile/edit.blade.php`：4 個欄位
  - `goals/edit.blade.php`：4 個欄位
- **程式碼格式**：清除所有尾隨空格，符合 PSR 標準
- **條件 class 優化**：使用 `@php` 區塊提取條件 class，避免衝突

#### 積分系統計算範例
- **正常每天記錄**：7 天總計 +140 積分（記錄獎勵）+ 50 積分（7 天成就）= **190 積分**
- **漏記 3 天後記錄**：-30 積分（扣分）+ 20 積分（記錄獎勵）= **-10 積分淨值**
- **連續 30 天記錄**：600 積分（記錄獎勵）+ 350 積分（成就獎勵）= **950 積分**

### 技術細節
- **服務層擴展**：
  - `PointsService`：新增 `deductPointsSafely()` 方法，確保積分不會低於 0
  - `AchievementService`：新增 `checkWeightRecordingAchievements()` 方法和連續記錄計算邏輯
- **控制器更新**：
  - `ProfileController`：新增 `start_weight` 驗證和更新邏輯
  - `WeightController`：整合記錄獎勵、扣分檢查和成就檢查流程
- **資料庫擴展**：
  - `AchievementSeeder`：新增兩個記錄體重成就定義
- **視圖更新**：
  - `dashboard.blade.php`：新增記錄獎勵和扣分通知顯示
  - `profile/edit.blade.php`：新增起始體重輸入欄位和當前資料顯示

## 歷史更新：減重遊戲化系統優化完成 (2026年1月)

### ✅ 遊戲化功能完整實作

已完成減重遊戲化系統的完整實作和優化：

#### Phase 1: 遊戲化核心功能（已完成）
- **資料庫架構**：5 個新資料表（daily_logs, achievements, user_achievements, rewards, 以及擴展 users 表）
- **服務類別**：
  - `DailyTaskService`：每日任務管理和積分計算
  - `PointsService`：積分管理（獲得、扣除、記錄）
  - `AchievementService`：成就檢查和解鎖邏輯
- **控制器**：
  - `DailyLogController`：每日任務和記錄管理
  - `AchievementController`：成就牆展示
  - `RewardController`：獎勵商店和兌換歷史
- **視圖**：完整的 Blade 模板，使用 Tailwind CSS 和 Alpine.js

#### Phase 2: 效能優化與功能擴展（2026年1月）
- **效能優化**：
  - 實作多層快取機制，減少資料庫查詢 50-70%
  - 頁面載入時間減少 30-40%
  - 特殊成就檢查時間減少 60-80%
- **統計圖表功能**：
  - 積分趨勢圖（Chart.js 折線圖）
  - 任務完成率圓餅圖
  - 連續達成天數趨勢圖（柱狀圖）
  - 支援 7/30/90/180 天的時間範圍選擇
- **報表功能**：
  - 週報表：本週表現完整總結
  - 月報表：本月表現和目標建議
  - 響應式設計，支援手機和桌面端

#### Phase 3: UI/UX 改善（2026年1月）
- **動畫效果**：
  - 成就解鎖通知動畫（滑入、震動、自動消失）
  - 任務完成互動效果（勾選動畫、完成慶祝）
  - 積分數字滾動動畫
  - 進度條平滑填充動畫
- **響應式優化**：所有新增功能完整支援手機端顯示

#### 測試覆蓋
- **Feature 測試**：54 個測試全部通過（130 個斷言）
  - GamificationStatsTest（統計功能測試）
  - WeeklyReportTest（週報表測試）
  - MonthlyReportTest（月報表測試）
  - AchievementTest、DailyLogTest、RewardTest 等

### 技術文件
- **遊戲化構想文件**：`.ai-dev/issue/減重遊戲功能/sparkle.md`
- **實作進度記錄**：`.ai-dev/issue/減重遊戲功能/progress.md`

## 歷史更新：資料庫錯誤修復與系統穩定性提升 (2025年9月)

### 重要資料庫修復 🔧
- **安全性修復**：移除配置文件中的硬編碼資料庫憑證，改為使用環境變數
- **模型一致性修復**：修正 Weight 模型的欄位定義不一致問題
  - 更新 `fillable` 陣列：`'user'` → `'user_id'`
  - 修正關聯方法外鍵：從 `'user'` 改為 `'user_id'`
  - 升級至 Laravel 12 標準：`$dates` 屬性 → `casts()` 方法
- **測試環境隔離**：配置 SQLite 內存資料庫作為測試環境，避免測試影響生產資料
- **生產環境穩定性**：解決本機測試正常但部署後出錯的問題

### 系統增強功能
- **體重目標管理系統**：完整的目標設定、追蹤和管理功能
- **數據分析功能**：體重趨勢分析、健康指標計算 (BMI)
- **數據導出功能**：支援 CSV 和 PDF 格式的數據導出
- **目標進度追蹤**：視覺化目標達成進度

### 技術修復與改進
- **AJAX 請求修復**：修復前端 AJAX 請求的 `expectsJson()` 問題
- **CSV 導出修復**：修正 CSV 導出方法的返回類型聲明
- **前端優化**：改進 AJAX 請求頭設置，確保正確的 JSON 響應
- **程式碼現代化**：使用 Laravel 12 最新特性和最佳實踐
- **測試覆蓋率**：43 個測試全部通過，確保系統穩定性

### 代碼品質提升
- 優化前端 JavaScript 請求處理
- 改進錯誤處理和用戶反饋機制
- 增強數據驗證和安全性
- 優化數據庫查詢和快取機制
- 提升程式碼可維護性和擴展性

## 歷史更新：用戶界面優化 (2024年12月)

### 歡迎頁面全面重設計
- **現代化設計**：採用漸層背景和現代 UI 元素
- **響應式佈局**：優化手機和桌面端顯示效果
- **品牌一致性**：統一視覺風格和色彩方案
- **功能展示**：添加實際功能預覽和統計數據
- **靜態頁面**：建立隱私政策、使用條款、聯絡我們頁面

### 認證系統界面優化
- **左右分欄設計**：左側品牌展示，右側表單區域
- **視覺效果提升**：漸層背景、陰影效果、過渡動畫
- **用戶體驗改善**：更大的輸入框、清晰的提示文字
- **功能完整性**：登入、註冊、忘記密碼頁面全面優化
- **無障礙設計**：良好的對比度和可讀性

### 技術改進
- **PostCSS 配置**：修復 Tailwind CSS 編譯問題
- **字體優化**：調整字體配置避免構建錯誤
- **路由擴展**：添加靜態頁面路由支援
- **組件重構**：優化認證組件結構和樣式

## 學習心得

通過這個專案的開發和升級過程，我獲得了以下寶貴經驗：

1. 深入理解 Laravel 框架的核心機制和演進方向
2. 掌握大型框架版本升級的系統性方法和最佳實踐
3. 增強對前端和後端技術整合的理解
4. 提升代碼質量和維護性的實踐經驗
5. **UI/UX 設計實踐**：學習現代化網頁設計和用戶體驗優化
6. **漸進式開發**：掌握穩定的迭代開發方法，避免破壞性變更

## 授權

本專案採用 [MIT 授權](https://opensource.org/licenses/MIT)。
# Test commit for GitHub Actions
